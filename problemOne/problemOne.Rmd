---
title: "problemOne"
author: "Daniel Emaasit"
date: "February 10, 2015"
output: word_document
---

## Problem C17.1
Use the data in PNTSPRD.RAW for this exercise:

# Section (i)
The variable favwin is a binary variable if the team favored by the Las Vegas
point spread wins. A linear probability model to estimate the probability that the favored team wins is:
P(favwin=1|spread)=beta0 + beta1(spread)

Explain why, if the spread incorporates all relevant information, we expect beta0=0.5

If spread is zero, there is no favorite, and the probability that the team we (arbitrarily) label the favorite should have a 50% chance of winning.

# subsection (ii)

Estimate the model from part (i) by OLS. Test H0:0.5 against a two-sided
alternative. Use both the usual and heteroskedasticity-robust standard errors.

```{r}
## install packages to read dta files
install.packages("devtools")
library("devtools")
devtools::install_github("hadley/haven")
library(haven)

## reada the data file into R
data1<-read_dta("PNTSPRD.dta")
head(data1)

## estimate the model from part(i) by OLS using usual standard erros
lm1<-lm(favwin~spread, data=data1)
install.packages("stargazer")
library(stargazer)
coeftest(lm1)

##testing the hypothesis that H0=0.5
calculated.t.value1=(0.5769492-0.5)/0.0282345
calculated.t.value1

## the rule
Reject the null hypothesis if |calculated t value|>|critical t value|,

##decision
since the |calculated.t.value1|>1.96, we reject the null hypothesis

##inference
beta0 is not equal to 0.5

```



```{r}
##estimate the model from part(i) by OLS using heteroskedasticity-robust standard errors
install.packages("AER")
library(AER)
coeftest(lm1, vcov = vcovHC)

##testing the hypothesis that H0=0.5
calculated.t.value2=(0.5769492-0.5)/0.0317187
calculated.t.value2

## the rule
Reject the null hypothesis if |calculated t value|>|critical t value|,

##decision
since the |calculated.t.value2|>1.96, we reject the null hypothesis

##inference
beta0 is not equal to 0.5
```



# Subsection (iii)
Is spread statistically significant? What is the estimated probability that the
favored team wins when spread=10?

Yes, spread is statistically significant.

```{r}
## estimate the Probaility
newdata1<-data.frame(spread=10)
predict(lm1, type="response", newdata1)
```

The estimated probability is 0.7706042

# Subsection (iv)
Now, estimate a probit model for P(favwin=1|spread ). Interpret and test the null hypothesis that the intercept is zero. [Hint: Remember that theta= 0.5.]

```{r}
data1$favwin<-as.factor(data1$favwin)
glm1<-glm(favwin~spread, data=data1, family=binomial(link="probit"))
stargazer(glm1, type = "text")
```


# Subsection (v)
Use the probit model to estimate the probability that the favored team wins when
spread  10. Compare this with the LPM estimate from part (iii).

```{r}
## estimated Probaility using the probit model
newdata2<-data.frame(spread=10)
predict(glm1, type="response", newdata2)
```

The estimated probability is 0.8196512. This probability is higher than the one estimated using the LPM.

# Subsection (vi)
Add the variables favhome, fav25, and und25 to the probit model and test joint significance of these variables using the likelihood ratio test. (How many df are in the chi-square distribution?) Interpret this result, focusing on the question of whether the spread incorporates all observable information prior to a game.


```{r}
## convert the new variables from character types to factor types
data1$favhome<-as.factor(data1$favhome)
data1$fav25<-as.factor(data1$fav25)
data1$und25<-as.factor(data1$und25)

## add the variables to the probit model
glm2<-glm(favwin~spread+favhome+fav25+und25, data=data1, family=binomial(link="probit"))
stargazer(glm2, type = "text")
```

The value of the Log Likelihood is -262.642
 
```{r}
## calculate the value of the likelihood ratio statistic
2*(-262.642 - (-263.562))
```

Since the likelihood ratio statistic of 1.84 is greater than the p-value from the chi-square distribution of 0.61, the added variables are jointly not significant. This can be infered to mean that these added variables have no additional power for predicting the outcome.

## Problem C17.2

Use the data in LOANAPP.RAW for this exercise


# Subsection (i)
Estimate a probit model of approve on white. Find the estimated probability of
loan approval for both whites and nonwhites. How do these compare with the
linear probability estimates?

```{r}
## start by reading the data into R
data2<-read_dta("LOANAPP.dta")

## convert the variables from character types to factors
data2$white<-as.factor(data2$white)
data2$approve<-as.factor(data2$approve)

## estimate a probit model of approve on white
glm3<-glm(approve~white, data2, family=binomial(link="probit"))
stargazer(glm3, type="text")

## find the estimated probability for whites
newdata3<-data.frame(white=1)
newdata3$white<-as.factor(newdata3$white)
predict(glm3, type="response", newdata3)

# find the estimated probability for non-whites
newdata4<-data.frame(white=0)
newdata4$white<-as.factor(newdata4$white)
predict(glm3, type="response", newdata4)
```

The predicted probability for whites and non-whites is 0.9083879 and 0.7077922 respectively.


# Subsection (ii)
Now, add the variables hrat, obrat, loanprc, unem, male, married, dep, sch,
cosign, chist, pubrec, mortlat1, mortlat2, and vr to the probit model. Is there
statistically significant evidence of discrimination against nonwhites?

```{r}
## convert some of variables from characters to factors
data2$male<-as.factor(data2$male)
data2$male<-as.factor(data2$male)
data2$male<-as.factor(data2$male)
data2$male<-as.factor(data2$male)
data2$male<-as.factor(data2$male)
data2$male<-as.factor(data2$male)
data2$male<-as.factor(data2$male)

## estimate the new probit model
glm4<-glm(approve~white+hrat+obrat+loanprc+unem+male+married+dep+sch+cosign+chist+pubrec+mortlat2+vr, data2, family=binomial(link="probit"))
stargazer(glm4, type="text")

```



# Subsction (iii)
Estimate the model from part (ii) by logit. Compare the coefficient on white to the
probit estimate.


# Subsection (iv)
Use equation (17.17) to estimate the sizes of the discrimination effects for probit and logit.


## Problem C17.3
Use the data in FRINGE.RAW for this exercise

# Subsection (i)
For what percentage of the workers in the sample is pension equal to zero? What
is the range of pension for workers with nonzero pension benefits? Why is a Tobit
model appropriate for modeling pension?


# Subsection (ii)
Estimate a Tobit model explaining pension in terms of exper, age, tenure, educ,
depends, married, white, and male. Do whites and males have statistically significant higher expected pension benefits?


# Subsection (iii)
Use the results from part (ii) to estimate the difference in expected pension
benefits for a white male and a nonwhite female, both of whom are 35 years old,
are single with no dependents, have 16 years of education, and have 10 years of
experience.


# Subsection (iv)
Add union to the Tobit model and comment on its significance.


# Subsection (v)
Apply the Tobit model from part (iv) but with peratio, the pension-earnings ratio,
as the dependent variable. (Notice that this is a fraction between zero and one, but,though it often takes on the value zero, it never gets close to being unity. Thus, a Tobit model is fine as an approximation.) Does gender or race have an effect on the pension-earnings ratio?











